/* æ¬Šé™ç®¡ç† Excel è™•ç†å°ˆæ¡ˆ
excel-processor/
â”œâ”€â”€ src/
â”‚   â”œâ”€â”€ main/
â”‚   â”‚   â”œâ”€â”€ java/
â”‚   â”‚   â”‚   â””â”€â”€ com/
â”‚   â”‚   â”‚       â””â”€â”€ example/
â”‚   â”‚   â”‚           â””â”€â”€ excelprocessor/
â”‚   â”‚   â”‚               â”œâ”€â”€ ExcelProcessorApplication.java
â”‚   â”‚   â”‚               â”œâ”€â”€ controller/
â”‚   â”‚   â”‚               â”‚   â””â”€â”€ PermissionExcelController.java
â”‚   â”‚   â”‚               â”œâ”€â”€ service/
â”‚   â”‚   â”‚               â”‚   â””â”€â”€ PermissionExcelService.java
â”‚   â”‚   â”‚               â”œâ”€â”€ model/
â”‚   â”‚   â”‚               â”‚   â”œâ”€â”€ PermissionData.java
â”‚   â”‚   â”‚               â”‚   â””â”€â”€ SqlGenerationResult.java
â”‚   â”‚   â”‚               â””â”€â”€ util/
â”‚   â”‚   â”‚                   â””â”€â”€ SqlGenerator.java
â”‚   â”‚   â””â”€â”€ resources/
â”‚   â”‚       â”œâ”€â”€ templates/
â”‚   â”‚       â”‚   â”œâ”€â”€ upload.html
â”‚   â”‚       â”‚   â””â”€â”€ result.html
â”‚   â”‚       â”œâ”€â”€ static/
â”‚   â”‚       â”‚   â””â”€â”€ css/
â”‚   â”‚       â”‚       â””â”€â”€ main.css
â”‚   â”‚       â””â”€â”€ application.yml
â””â”€â”€ pom.xml
*/

// pom.xml
<?xml version="1.0" encoding="UTF-8"?>
<project xmlns="http://maven.apache.org/POM/4.0.0" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
         xsi:schemaLocation="http://maven.apache.org/POM/4.0.0 https://maven.apache.org/xsd/maven-4.0.0.xsd">
    <modelVersion>4.0.0</modelVersion>
    <parent>
        <groupId>org.springframework.boot</groupId>
        <artifactId>spring-boot-starter-parent</artifactId>
        <version>3.2.0</version>
        <relativePath/>
    </parent>
    <groupId>com.example</groupId>
    <artifactId>permission-excel-processor</artifactId>
    <version>0.0.1-SNAPSHOT</version>
    <name>permission-excel-processor</name>
    <description>æ¬Šé™ç®¡ç† Excel è™•ç†ç³»çµ±</description>
    
    <properties>
        <java.version>17</java.version>
    </properties>
    
    <dependencies>
        <dependency>
            <groupId>org.springframework.boot</groupId>
            <artifactId>spring-boot-starter-thymeleaf</artifactId>
        </dependency>
        <dependency>
            <groupId>org.springframework.boot</groupId>
            <artifactId>spring-boot-starter-web</artifactId>
        </dependency>
        
        <!-- Excel è™•ç†ç›¸é—œä¾è³´ -->
        <dependency>
            <groupId>org.apache.poi</groupId>
            <artifactId>poi</artifactId>
            <version>5.2.4</version>
        </dependency>
        <dependency>
            <groupId>org.apache.poi</groupId>
            <artifactId>poi-ooxml</artifactId>
            <version>5.2.4</version>
        </dependency>
        
        <dependency>
            <groupId>org.projectlombok</groupId>
            <artifactId>lombok</artifactId>
            <optional>true</optional>
        </dependency>
        
        <dependency>
            <groupId>javax.servlet</groupId>
            <artifactId>javax.servlet-api</artifactId>
            <version>4.0.1</version>
            <scope>provided</scope>
        </dependency>
        
        <dependency>
            <groupId>org.springframework.boot</groupId>
            <artifactId>spring-boot-devtools</artifactId>
            <scope>runtime</scope>
            <optional>true</optional>
        </dependency>
        
        <dependency>
            <groupId>org.springframework.boot</groupId>
            <artifactId>spring-boot-starter-test</artifactId>
            <scope>test</scope>
        </dependency>
    </dependencies>
    
    <build>
        <plugins>
            <plugin>
                <groupId>org.springframework.boot</groupId>
                <artifactId>spring-boot-maven-plugin</artifactId>
                <configuration>
                    <excludes>
                        <exclude>
                            <groupId>org.projectlombok</groupId>
                            <artifactId>lombok</artifactId>
                        </exclude>
                    </excludes>
                </configuration>
            </plugin>
        </plugins>
    </build>
</project>

// src/main/java/com/example/excelprocessor/ExcelProcessorApplication.java
package com.example.excelprocessor;

import org.springframework.boot.SpringApplication;
import org.springframework.boot.autoconfigure.SpringBootApplication;

@SpringBootApplication
public class ExcelProcessorApplication {
    public static void main(String[] args) {
        SpringApplication.run(ExcelProcessorApplication.class, args);
    }
}

// src/main/java/com/example/excelprocessor/model/PermissionData.java
package com.example.excelprocessor.model;

import lombok.AllArgsConstructor;
import lombok.Data;
import lombok.NoArgsConstructor;

@Data
@NoArgsConstructor
@AllArgsConstructor
public class PermissionData {
    private String action;           // æ–°å¢/åˆªé™¤
    private String systemCode;       // æ‡‰ç”¨ç³»çµ±ä»£è™Ÿ
    private String roleCode;         // è§’è‰²ä»£ç¢¼
    private String functionName;     // åŠŸèƒ½åç¨±
    private String permissionName;   // æ¬Šé™åç¨±
    private String functionCategory; // åŠŸèƒ½åˆ†é¡
    private int rowNumber;           // Excel è¡Œè™Ÿï¼Œç”¨æ–¼éŒ¯èª¤è¿½è¹¤
    
    // æª¢æŸ¥æ˜¯å¦ç‚º TING-INGENIUM ç³»çµ±
    public boolean isTingIngeniumSystem() {
        return "TING-INGENIUM".equalsIgnoreCase(this.systemCode);
    }
    
    // æª¢æŸ¥è³‡æ–™æ˜¯å¦å®Œæ•´ï¼ˆåŠŸèƒ½åç¨±å’ŒåŠŸèƒ½åˆ†é¡ä¸ç‚ºç©ºï¼‰
    public boolean isDataComplete() {
        return functionName != null && !functionName.trim().isEmpty() &&
               functionCategory != null && !functionCategory.trim().isEmpty();
    }
}

// src/main/java/com/example/excelprocessor/model/SqlGenerationResult.java
package com.example.excelprocessor.model;

import lombok.AllArgsConstructor;
import lombok.Data;
import lombok.NoArgsConstructor;

import java.util.List;

@Data
@NoArgsConstructor
@AllArgsConstructor
public class SqlGenerationResult {
    private List<String> insertStatements;
    private List<String> deleteStatements;
    private int totalProcessed;
    private int filteredCount;
    private int validDataCount;
    private List<String> errorMessages;
    private String fileName;
}

// src/main/java/com/example/excelprocessor/service/PermissionExcelService.java
package com.example.excelprocessor.service;

import com.example.excelprocessor.model.PermissionData;
import com.example.excelprocessor.model.SqlGenerationResult;
import com.example.excelprocessor.util.SqlGenerator;
import org.apache.poi.ss.usermodel.*;
import org.apache.poi.xssf.usermodel.XSSFWorkbook;
import org.apache.poi.hssf.usermodel.HSSFWorkbook;
import org.springframework.stereotype.Service;
import org.springframework.web.multipart.MultipartFile;

import java.io.IOException;
import java.io.InputStream;
import java.util.ArrayList;
import java.util.Iterator;
import java.util.List;
import java.util.stream.Collectors;

@Service
public class PermissionExcelService {

    private static final String TARGET_SYSTEM = "TING-INGENIUM";
    private static final int HEADER_ROW = 0; // å‡è¨­ç¬¬ä¸€è¡Œæ˜¯æ¨™é¡Œ
    
    // Excel æ¬„ä½ç´¢å¼• (æ ¹æ“šæ‚¨çš„ Excel çµæ§‹èª¿æ•´)
    private static final int COL_ACTION = 0;           // æ–°å¢/åˆªé™¤
    private static final int COL_SYSTEM_CODE = 2;      // æ‡‰ç”¨ç³»çµ±ä»£è™Ÿ
    private static final int COL_ROLE_CODE = 3;        // è§’è‰²ä»£ç¢¼
    private static final int COL_FUNCTION_NAME = 4;    // åŠŸèƒ½åç¨±
    private static final int COL_PERMISSION_NAME = 5;  // æ¬Šé™åç¨±
    private static final int COL_FUNCTION_CATEGORY = 6; // åŠŸèƒ½åˆ†é¡

    public SqlGenerationResult processExcelFile(MultipartFile file) throws IOException {
        List<PermissionData> allData = new ArrayList<>();
        List<String> errorMessages = new ArrayList<>();
        
        try (InputStream inputStream = file.getInputStream()) {
            Workbook workbook = getWorkbook(inputStream, file.getOriginalFilename());
            Sheet sheet = workbook.getSheetAt(0);
            
            Iterator<Row> rowIterator = sheet.iterator();
            int rowNumber = 0;
            
            // è·³éæ¨™é¡Œè¡Œ
            if (rowIterator.hasNext()) {
                rowIterator.next();
                rowNumber++;
            }
            
            // è®€å–æ¯ä¸€è¡Œè³‡æ–™
            while (rowIterator.hasNext()) {
                Row row = rowIterator.next();
                rowNumber++;
                
                try {
                    PermissionData data = parseRowToPermissionData(row, rowNumber);
                    if (data != null) {
                        allData.add(data);
                    }
                } catch (Exception e) {
                    errorMessages.add(String.format("ç¬¬ %d è¡Œè³‡æ–™è§£æéŒ¯èª¤: %s", rowNumber, e.getMessage()));
                }
            }
            
            workbook.close();
        }
        
        // ç¯©é¸ TING-INGENIUM ç³»çµ±çš„è³‡æ–™
        List<PermissionData> filteredData = allData.stream()
                .filter(PermissionData::isTingIngeniumSystem)
                .collect(Collectors.toList());
        
        // é€²ä¸€æ­¥ç¯©é¸æœ‰æ•ˆè³‡æ–™ï¼ˆåŠŸèƒ½åç¨±å’ŒåŠŸèƒ½åˆ†é¡ä¸ç‚ºç©ºï¼‰
        List<PermissionData> validData = filteredData.stream()
                .filter(PermissionData::isDataComplete)
                .collect(Collectors.toList());
        
        // æ·»åŠ ç„¡æ•ˆè³‡æ–™çš„éŒ¯èª¤è¨Šæ¯
        filteredData.stream()
                .filter(data -> !data.isDataComplete())
                .forEach(data -> errorMessages.add(
                    String.format("ç¬¬ %d è¡Œ: åŠŸèƒ½åç¨±æˆ–åŠŸèƒ½åˆ†é¡ç‚ºç©º", data.getRowNumber())
                ));
        
        // ç”Ÿæˆ SQL èªå¥
        SqlGenerator sqlGenerator = new SqlGenerator();
        List<String> insertStatements = sqlGenerator.generateInsertStatements(validData);
        List<String> deleteStatements = sqlGenerator.generateDeleteStatements(validData);
        
        return new SqlGenerationResult(
                insertStatements,
                deleteStatements,
                allData.size(),
                filteredData.size(),
                validData.size(),
                errorMessages,
                file.getOriginalFilename()
        );
    }
    
    private PermissionData parseRowToPermissionData(Row row, int rowNumber) {
        // æª¢æŸ¥è¡Œæ˜¯å¦ç‚ºç©º
        if (isRowEmpty(row)) {
            return null;
        }
        
        PermissionData data = new PermissionData();
        data.setRowNumber(rowNumber);
        
        data.setAction(getCellValueAsString(row.getCell(COL_ACTION)));
        data.setSystemCode(getCellValueAsString(row.getCell(COL_SYSTEM_CODE)));
        data.setRoleCode(getCellValueAsString(row.getCell(COL_ROLE_CODE)));
        data.setFunctionName(getCellValueAsString(row.getCell(COL_FUNCTION_NAME)));
        data.setPermissionName(getCellValueAsString(row.getCell(COL_PERMISSION_NAME)));
        data.setFunctionCategory(getCellValueAsString(row.getCell(COL_FUNCTION_CATEGORY)));
        
        return data;
    }
    
    private boolean isRowEmpty(Row row) {
        if (row == null) return true;
        
        for (int i = row.getFirstCellNum(); i < row.getLastCellNum(); i++) {
            Cell cell = row.getCell(i);
            if (cell != null && cell.getCellType() != CellType.BLANK) {
                String cellValue = getCellValueAsString(cell);
                if (cellValue != null && !cellValue.trim().isEmpty()) {
                    return false;
                }
            }
        }
        return true;
    }
    
    private String getCellValueAsString(Cell cell) {
        if (cell == null) {
            return "";
        }
        
        switch (cell.getCellType()) {
            case STRING:
                return cell.getStringCellValue().trim();
            case NUMERIC:
                if (DateUtil.isCellDateFormatted(cell)) {
                    return cell.getLocalDateTimeCellValue().toString();
                } else {
                    // è™•ç†æ•¸å­—æ ¼å¼ï¼Œé¿å…ç§‘å­¸è¨˜è™Ÿ
                    double numericValue = cell.getNumericCellValue();
                    if (numericValue == Math.floor(numericValue)) {
                        return String.valueOf((long) numericValue);
                    } else {
                        return String.valueOf(numericValue);
                    }
                }
            case BOOLEAN:
                return String.valueOf(cell.getBooleanCellValue());
            case FORMULA:
                return cell.getCellFormula();
            case BLANK:
                return "";
            default:
                return "";
        }
    }
    
    private Workbook getWorkbook(InputStream inputStream, String fileName) throws IOException {
        if (fileName.endsWith(".xlsx")) {
            return new XSSFWorkbook(inputStream);
        } else if (fileName.endsWith(".xls")) {
            return new HSSFWorkbook(inputStream);
        } else {
            throw new IllegalArgumentException("ä¸æ”¯æ´çš„æª”æ¡ˆæ ¼å¼ï¼Œè«‹ä¸Šå‚³ .xls æˆ– .xlsx æª”æ¡ˆ");
        }
    }
}

// src/main/java/com/example/excelprocessor/util/SqlGenerator.java
package com.example.excelprocessor.util;

import com.example.excelprocessor.model.PermissionData;
import org.springframework.stereotype.Component;

import java.util.List;
import java.util.stream.Collectors;

@Component
public class SqlGenerator {
    
    public List<String> generateInsertStatements(List<PermissionData> permissionDataList) {
        return permissionDataList.stream()
                .filter(data -> "æ–°å¢".equals(data.getAction()))
                .map(this::createInsertStatement)
                .collect(Collectors.toList());
    }
    
    public List<String> generateDeleteStatements(List<PermissionData> permissionDataList) {
        return permissionDataList.stream()
                .filter(data -> "åˆªé™¤".equals(data.getAction()))
                .map(this::createDeleteStatement)
                .collect(Collectors.toList());
    }
    
    private String createInsertStatement(PermissionData data) {
        // è½‰ç¾©å–®å¼•è™Ÿä»¥é˜²æ­¢ SQL æ³¨å…¥
        String functionName = escapeSqlString(data.getFunctionName());
        String functionCategory = escapeSqlString(data.getFunctionCategory());
        
        return String.format("INSERT INTO TBPFS VALUES ('T1', '%s', '%s');", 
                functionName, functionCategory);
    }
    
    private String createDeleteStatement(PermissionData data) {
        // ç‚ºåˆªé™¤æ“ä½œå‰µå»ºå°æ‡‰çš„ DELETE èªå¥
        String functionName = escapeSqlString(data.getFunctionName());
        String functionCategory = escapeSqlString(data.getFunctionCategory());
        
        return String.format("DELETE FROM TBPFS WHERE COL1 = 'T1' AND COL2 = '%s' AND COL3 = '%s';", 
                functionName, functionCategory);
    }
    
    /**
     * è½‰ç¾© SQL å­—ä¸²ä¸­çš„å–®å¼•è™Ÿ
     */
    private String escapeSqlString(String input) {
        if (input == null) {
            return "";
        }
        return input.replace("'", "''");
    }
}

// src/main/java/com/example/excelprocessor/controller/PermissionExcelController.java
package com.example.excelprocessor.controller;

import com.example.excelprocessor.model.SqlGenerationResult;
import com.example.excelprocessor.service.PermissionExcelService;
import org.springframework.beans.factory.annotation.Autowired;
import org.springframework.core.io.ByteArrayResource;
import org.springframework.http.HttpHeaders;
import org.springframework.http.MediaType;
import org.springframework.http.ResponseEntity;
import org.springframework.stereotype.Controller;
import org.springframework.ui.Model;
import org.springframework.web.bind.annotation.GetMapping;
import org.springframework.web.bind.annotation.PostMapping;
import org.springframework.web.bind.annotation.RequestParam;
import org.springframework.web.multipart.MultipartFile;
import org.springframework.web.servlet.mvc.support.RedirectAttributes;

import jakarta.servlet.http.HttpSession;
import java.io.IOException;
import java.nio.charset.StandardCharsets;
import java.text.SimpleDateFormat;
import java.util.Date;

@Controller
public class PermissionExcelController {

    private final PermissionExcelService permissionExcelService;

    @Autowired
    public PermissionExcelController(PermissionExcelService permissionExcelService) {
        this.permissionExcelService = permissionExcelService;
    }

    @GetMapping("/")
    public String home() {
        return "upload";
    }

    @PostMapping("/upload")
    public String uploadFile(@RequestParam("file") MultipartFile file, 
                             RedirectAttributes redirectAttributes,
                             Model model,
                             HttpSession session) {
        
        // æª¢æŸ¥æª”æ¡ˆæ˜¯å¦ç‚ºç©º
        if (file.isEmpty()) {
            redirectAttributes.addFlashAttribute("error", "è«‹é¸æ“‡è¦ä¸Šå‚³çš„æª”æ¡ˆ");
            return "redirect:/";
        }
        
        // æª¢æŸ¥æª”æ¡ˆæ ¼å¼
        String fileName = file.getOriginalFilename();
        if (fileName == null || !(fileName.toLowerCase().endsWith(".xls") || fileName.toLowerCase().endsWith(".xlsx"))) {
            redirectAttributes.addFlashAttribute("error", "è«‹ä¸Šå‚³ Excel æª”æ¡ˆ (.xls æˆ– .xlsx)");
            return "redirect:/";
        }
        
        try {
            // è™•ç† Excel æª”æ¡ˆä¸¦ç”Ÿæˆ SQL
            SqlGenerationResult result = permissionExcelService.processExcelFile(file);
            
            // å°‡çµæœå­˜åˆ° session ä¸­ï¼Œç”¨æ–¼ä¸‹è¼‰
            session.setAttribute("sqlResult", result);
            
            // å°‡çµæœå‚³éåˆ°é é¢
            model.addAttribute("result", result);
            
            return "result";
        } catch (IOException e) {
            redirectAttributes.addFlashAttribute("error", "è™•ç†æª”æ¡ˆæ™‚ç™¼ç”ŸéŒ¯èª¤: " + e.getMessage());
            return "redirect:/";
        } catch (Exception e) {
            redirectAttributes.addFlashAttribute("error", "ç³»çµ±éŒ¯èª¤: " + e.getMessage());
            return "redirect:/";
        }
    }
    
    @GetMapping("/download/sql")
    public ResponseEntity<ByteArrayResource> downloadSqlFile(HttpSession session) {
        SqlGenerationResult result = (SqlGenerationResult) session.getAttribute("sqlResult");
        
        if (result == null) {
            return ResponseEntity.notFound().build();
        }
        
        // ç”Ÿæˆ SQL æª”æ¡ˆå…§å®¹
        StringBuilder sqlContent = new StringBuilder();
        
        // æ·»åŠ æª”æ¡ˆé ­éƒ¨è¨»é‡‹
        sqlContent.append("-- ========================================\n");
        sqlContent.append("-- æ¬Šé™ç®¡ç†ç³»çµ± SQL èªå¥\n");
        sqlContent.append("-- ä¾†æºæª”æ¡ˆ: ").append(result.getFileName()).append("\n");
        sqlContent.append("-- ç”Ÿæˆæ™‚é–“: ").append(new SimpleDateFormat("yyyy-MM-dd HH:mm:ss").format(new Date())).append("\n");
        sqlContent.append("-- ç¸½è™•ç†ç­†æ•¸: ").append(result.getTotalProcessed()).append("\n");
        sqlContent.append("-- TING-INGENIUM ç­†æ•¸: ").append(result.getFilteredCount()).append("\n");
        sqlContent.append("-- æœ‰æ•ˆè³‡æ–™ç­†æ•¸: ").append(result.getValidDataCount()).append("\n");
        sqlContent.append("-- ========================================\n\n");
        
        // æ·»åŠ  INSERT èªå¥
        if (!result.getInsertStatements().isEmpty()) {
            sqlContent.append("-- INSERT èªå¥ (æ–°å¢æ“ä½œ)\n");
            sqlContent.append("-- å…± ").append(result.getInsertStatements().size()).append(" ç­†\n");
            sqlContent.append("-- ========================================\n\n");
            
            for (String insertSql : result.getInsertStatements()) {
                sqlContent.append(insertSql).append("\n");
            }
            sqlContent.append("\n");
        }
        
        // æ·»åŠ  DELETE èªå¥
        if (!result.getDeleteStatements().isEmpty()) {
            sqlContent.append("-- DELETE èªå¥ (åˆªé™¤æ“ä½œ)\n");
            sqlContent.append("-- å…± ").append(result.getDeleteStatements().size()).append(" ç­†\n");
            sqlContent.append("-- ========================================\n\n");
            
            for (String deleteSql : result.getDeleteStatements()) {
                sqlContent.append(deleteSql).append("\n");
            }
            sqlContent.append("\n");
        }
        
        // æ·»åŠ éŒ¯èª¤è¨Šæ¯
        if (!result.getErrorMessages().isEmpty()) {
            sqlContent.append("-- è™•ç†è­¦å‘Šè¨Šæ¯\n");
            sqlContent.append("-- ========================================\n");
            for (String errorMsg : result.getErrorMessages()) {
                sqlContent.append("-- ").append(errorMsg).append("\n");
            }
            sqlContent.append("\n");
        }
        
        sqlContent.append("-- æª”æ¡ˆçµæŸ\n");
        
        // å»ºç«‹æª”æ¡ˆåç¨±
        String timestamp = new SimpleDateFormat("yyyyMMdd_HHmmss").format(new Date());
        String downloadFileName = String.format("TING_INGENIUM_SQL_%s.sql", timestamp);
        
        // è½‰æ›ç‚º ByteArrayResource
        byte[] sqlBytes = sqlContent.toString().getBytes(StandardCharsets.UTF_8);
        ByteArrayResource resource = new ByteArrayResource(sqlBytes);
        
        return ResponseEntity.ok()
                .header(HttpHeaders.CONTENT_DISPOSITION, "attachment; filename=\"" + downloadFileName + "\"")
                .contentType(MediaType.parseMediaType("application/sql"))
                .contentLength(sqlBytes.length)
                .body(resource);
    }
}

// src/main/resources/templates/upload.html
<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <title>æ¬Šé™ç®¡ç† Excel è™•ç†ç³»çµ±</title>
    <link rel="stylesheet" th:href="@{/css/main.css}">
</head>
<body>
    <div class="container">
        <header>
            <h1>ğŸ” æ¬Šé™ç®¡ç† Excel è™•ç†ç³»çµ±</h1>
            <p class="subtitle">å°ˆé–€è™•ç† TING-INGENIUM ç³»çµ±æ¬Šé™è³‡æ–™ä¸¦ç”Ÿæˆ SQL èªå¥</p>
        </header>
        
        <div th:if="${error}" class="alert alert-error">
            <strong>éŒ¯èª¤:</strong> <span th:text="${error}"></span>
        </div>
        
        <div class="upload-card">
            <div class="upload-info">
                <h2>ğŸ“‹ Excel æª”æ¡ˆæ ¼å¼èªªæ˜</h2>
                <div class="info-grid">
                    <div class="info-item">
                        <strong>æ”¯æ´æ ¼å¼:</strong> .xls, .xlsx
                    </div>
                    <div class="info-item">
                        <strong>è™•ç†æ¢ä»¶:</strong> åƒ…è™•ç†ã€Œæ‡‰ç”¨ç³»çµ±ä»£è™Ÿã€= TING-INGENIUM çš„è³‡æ–™
                    </div>
                    <div class="info-item">
                        <strong>å¿…è¦æ¬„ä½:</strong> æ–°å¢/åˆªé™¤ã€æ‡‰ç”¨ç³»çµ±ä»£è™Ÿã€è§’è‰²ä»£ç¢¼ã€åŠŸèƒ½åç¨±ã€æ¬Šé™åç¨±ã€åŠŸèƒ½åˆ†é¡
                    </div>
                    <div class="info-item">
                        <strong>è¼¸å‡ºæ ¼å¼:</strong> INSERT INTO TBPFS ('T1', åŠŸèƒ½åç¨±, åŠŸèƒ½åˆ†é¡)
                    </div>
                </div>
            </div>
            
            <div class="upload-section">
                <h2>ğŸ“¤ ä¸Šå‚³ Excel æª”æ¡ˆ</h2>
                <form method="POST" th:action="@{/upload}" enctype="multipart/form-data" class="upload-form">
                    <div class="file-input-wrapper">
                        <input type="file" name="file" id="file" accept=".xls,.xlsx" required class="file-input">
                        <label for="file" class="file-label">
                            <span class="file-icon">ğŸ“</span>
                            <span class="file-text">é¸æ“‡ Excel æª”æ¡ˆ</span>
                        </label>
                    </div>
                    <button type="submit" class="btn btn-primary">
                        <span>ğŸš€ é–‹å§‹è™•ç†</span>
                    </button>
                </form>
            </div>
        </div>
    </div>
    
    <script>
        // æª”æ¡ˆé¸æ“‡æç¤º
        document.getElementById('file').addEventListener('change', function(e) {
            const fileName = e.target.files[0]?.name;
            const fileText = document.querySelector('.file-text');
            if (fileName) {
                fileText.textContent = fileName;
            } else {
                fileText.textContent = 'é¸æ“‡ Excel æª”æ¡ˆ';
            }
        });
    </script>
</body>
</html>

// src/main/resources/templates/result.html
<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <title>è™•ç†çµæœ - æ¬Šé™ç®¡ç† Excel è™•ç†ç³»çµ±</title>
    <link rel="stylesheet" th:href="@{/css/main.css}">
</head>
<body>
    <div class="container">
        <header>
            <h1>ğŸ“Š è™•ç†çµæœ</h1>
            <p class="subtitle" th:text="'æª”æ¡ˆ: ' + ${result.fileName}"></p>
        </header>
        
        <!-- çµ±è¨ˆè³‡è¨Š -->
        <div class="stats-grid">
            <div class="stat-card">
                <div class="stat-number" th:text="${result.totalProcessed}"></div>
                <div class="stat-label">ç¸½è™•ç†ç­†æ•¸</div>
            </div>
            <div class="stat-card">
                <div class="stat-number" th:text="${result.filteredCount}"></div>
                <div class="stat-label">TING-INGENIUM ç­†æ•¸</div>
            </div>
            <div class="stat-card">
                <div class="stat-number" th:text="${result.validDataCount}"></div>
                <div class="stat-label">æœ‰æ•ˆè³‡æ–™ç­†æ•¸</div>
            </div>
            <div class="stat-card">
                <div class="stat-number" th:text="${result.insertStatements.size()}"></div>
                <div class="stat-label">INSERT èªå¥</div>
            </div>
        </div>
        
        <!-- éŒ¯èª¤è¨Šæ¯ -->
        <div th:if="${!result.errorMessages.empty}" class="error-section">
            <h3>âš ï¸ è™•ç†è­¦å‘Š</h3>
            <div class="error-list">
                <div th:each="error : ${result.errorMessages}" class="error-item" th:text="${error}"></div>
            </div>
        </div>
        
        <!-- SQL é è¦½å’Œä¸‹è¼‰ -->
        <div th:if="${result.validDataCount > 0}" class="sql-section">
            <div class="section-header">
                <h3>ğŸ“„ SQL èªå¥é è¦½</h3>
                <a th:href="@{/download/sql}" class="btn btn-download">ğŸ“¥ ä¸‹è¼‰ SQL æª”æ¡ˆ</a>
            </div>
            
            <div class="sql-preview">
                <!-- INSERT èªå¥é è¦½ -->
                <div th:if="${!result.insertStatements.empty}" class="sql-preview-section">
                    <h4>âœ… INSERT èªå¥ (<span th:text="${result.insertStatements.size()}"></span> ç­†)</h4>
                    <div class="sql-container">
                        <pre class="sql-content"><span th:each="sql, iterStat : ${result.insertStatements}"><span th:if="${iterStat.index < 5}" th:text="${sql}"></span><span th:if="${iterStat.index < 4 and !iterStat.last}">
</span></span><span th:if="${result.insertStatements.size() > 5}">
-- ... çœç•¥å…¶é¤˜ <span th:text="${result.insertStatements.size() - 5}"></span> ç­†ï¼Œè«‹ä¸‹è¼‰å®Œæ•´ SQL æª”æ¡ˆ</span></pre>
                    </div>
                </div>
                
                <!-- DELETE èªå¥é è¦½ -->
                <div th:if="${!result.deleteStatements.empty}" class="sql-preview-section">
                    <h4>ğŸ—‘ï¸ DELETE èªå¥ (<span th:text="${result.deleteStatements.size()}"></span> ç­†)</h4>
                    <div class="sql-container">
                        <pre class="sql-content"><span th:each="sql, iterStat : ${result.deleteStatements}"><span th:if="${iterStat.index < 5}" th:text="${sql}"></span><span th:if="${iterStat.index < 4 and !iterStat.last}">
</span></span><span th:if="${result.deleteStatements.size() > 5}">
-- ... çœç•¥å…¶é¤˜ <span th:text="${result.deleteStatements.size() - 5}"></span> ç­†ï¼Œè«‹ä¸‹è¼‰å®Œæ•´ SQL æª”æ¡ˆ</span></pre>
                    </div>
                </div>
            </div>
        </div>
        
        <!-- æ²’æœ‰è³‡æ–™çš„æƒ…æ³ -->
        <div th:if="${result.validDataCount == 0}" class="no-data-section">
            <div class="no-data-card">
                <h3>ğŸ“­ æ²’æœ‰æ‰¾åˆ°æœ‰æ•ˆè³‡æ–™</h3>
                <p>è«‹ç¢ºèª Excel æª”æ¡ˆä¸­åŒ…å«ã€Œæ‡‰ç”¨ç³»çµ±ä»£è™Ÿã€ç‚º TING-INGENIUM çš„å®Œæ•´è³‡æ–™ã€‚</p>
            </div>
        </div>
        
        <div class="action-buttons">
            <a href="/" class="btn btn-secondary">ğŸ”„ é‡æ–°ä¸Šå‚³</a>
        </div>
    </div>
    
    <script>
        // æª”æ¡ˆé¸æ“‡æç¤º
        document.getElementById('file').addEventListener('change', function(e) {
            const fileName = e.target.files[0]?.name;
            const fileText = document.querySelector('.file-text');
            if (fileName) {
                fileText.textContent = fileName;
            } else {
                fileText.textContent = 'é¸æ“‡ Excel æª”æ¡ˆ';
            }
        });
    </script>
</body>
</html>

// src/main/resources/static/css/main.css
* {
    margin: 0;
    padding: 0;
    box-sizing: border-box;
}

body {
    font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
    line-height: 1.6;
    color: #333;
    background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
    min-height: 100vh;
}

.container {
    max-width: 1200px;
    margin: 0 auto;
    padding: 20px;
}

header {
    text-align: center;
    margin-bottom: 30px;
    color: white;
}

header h1 {
    font-size: 2.5rem;
    margin-bottom: 10px;
    text-shadow: 0 2px 4px rgba(0,0,0,0.3);
}

.subtitle {
    font-size: 1.1rem;
    opacity: 0.9;
}

/* ä¸Šå‚³é é¢æ¨£å¼ */
.upload-card {
    background: white;
    border-radius: 15px;
    box-shadow: 0 10px 30px rgba(0,0,0,0.2);
    overflow: hidden;
    margin-bottom: 30px;
}

.upload-info {
    background: #f8f9fa;
    padding: 30px;
    border-bottom: 1px solid #e9ecef;
}

.upload-info h2 {
    color: #495057;
    margin-bottom: 20px;
    font-size: 1.4rem;
}

.info-grid {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
    gap: 15px;
}

.info-item {
    background: white;
    padding: 15px;
    border-radius: 8px;
    border-left: 4px solid #667eea;
    box-shadow: 0 2px 5px rgba(0,0,0,0.1);
}

.info-item strong {
    color: #495057;
    display: block;
    margin-bottom: 5px;
}

.upload-section {
    padding: 30px;
}

.upload-section h2 {
    color: #495057;
    margin-bottom: 25px;
    font-size: 1.4rem;
}

.upload-form {
    text-align: center;
}

.file-input-wrapper {
    position: relative;
    display: inline-block;
    margin-bottom: 20px;
}

.file-input {
    position: absolute;
    left: -9999px;
}

.file-label {
    display: inline-flex;
    align-items: center;
    gap: 10px;
    padding: 15px 30px;
    background: #f8f9fa;
    border: 2px dashed #dee2e6;
    border-radius: 10px;
    cursor: pointer;
    transition: all 0.3s ease;
    font-size: 1.1rem;
}

.file-label:hover {
    background: #e9ecef;
    border-color: #667eea;
    transform: translateY(-2px);
}

.file-icon {
    font-size: 1.5rem;
}

/*